# Modian Insight

ä¸€ä¸ªåŸºäº TypeScript + Express çš„ä¼—ç­¹é¡¹ç›®æ•°æ®çˆ¬å–å’Œç®¡ç†ç³»ç»Ÿã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **æ™ºèƒ½çˆ¬å–**: æ”¯æŒæ‰¹é‡çˆ¬å–ä¼—ç­¹é¡¹ç›®æ•°æ®ï¼Œå¯æŒ‡å®šIDèŒƒå›´æˆ–å…·ä½“IDåˆ—è¡¨
- **æ•°æ®å»é‡**: æ™ºèƒ½å¯¹æ¯”é¡¹ç›®æ•°æ®å˜åŒ–ï¼Œåªæœ‰æ˜¾è‘—å˜åŒ–æ—¶æ‰ä¿å­˜æ–°ç‰ˆæœ¬
- **ç‰ˆæœ¬æ§åˆ¶**: å®Œæ•´çš„é¡¹ç›®æ•°æ®ç‰ˆæœ¬å†å²è®°å½•ï¼Œæ”¯æŒæ•°æ®å¯¹æ¯”å’Œè¶‹åŠ¿åˆ†æ
- **çµæ´»å­˜å‚¨**: æŒ‰é¡¹ç›®IDåˆ†å±‚å­˜å‚¨ï¼Œé¿å…å•ç›®å½•æ–‡ä»¶è¿‡å¤šï¼Œæ”¯æŒå¤šç›®å½•ç´¢å¼•
- **RESTful API**: å®Œæ•´çš„APIæ¥å£ï¼Œæ”¯æŒç³»ç»Ÿç›‘æ§ã€çˆ¬è™«æ§åˆ¶å’Œæ•°æ®æŸ¥è¯¢
- **å®æ—¶ç›‘æ§**: ç³»ç»ŸçŠ¶æ€ç›‘æ§ã€ä»»åŠ¡è¿›åº¦è·Ÿè¸ªå’Œè¯¦ç»†ç»Ÿè®¡ä¿¡æ¯
- **è§„èŒƒä»£ç **: TypeScriptä¸¥æ ¼ç±»å‹æ£€æŸ¥ï¼Œè§„èŒƒçš„ä»£ç ç»“æ„å’Œè¯¦ç»†æ³¨é‡Š

## ğŸ“‹ æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Express.js 4.18.2
- **å¼€å‘è¯­è¨€**: TypeScript 5.8.3
- **åŒ…ç®¡ç†å™¨**: pnpm
- **æ•°æ®å­˜å‚¨**: JSONæ–‡ä»¶å­˜å‚¨ + ç´¢å¼•ç³»ç»Ÿ
- **è®¤è¯æœºåˆ¶**: MD5ç­¾åè®¤è¯
- **ä»£ç è§„èŒƒ**: ESLint + Prettier

## ğŸ› ï¸ å®‰è£…å’Œè¿è¡Œ

### ç¯å¢ƒè¦æ±‚

- Node.js >= 16.0.0
- pnpm >= 8.0.0

### å®‰è£…ä¾èµ–

```bash
cd backend
pnpm install
```

### å¼€å‘æ¨¡å¼è¿è¡Œ

```bash
pnpm dev
```

### ç”Ÿäº§æ¨¡å¼è¿è¡Œ

```bash
pnpm build
pnpm start
```

### è¿è¡Œæµ‹è¯•

```bash
pnpm exec ts-node src/tests/basic.test.ts
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ index.ts      # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ systemController.ts    # ç³»ç»Ÿç®¡ç†
â”‚   â”‚   â”œâ”€â”€ crawlerController.ts   # çˆ¬è™«æ§åˆ¶
â”‚   â”‚   â””â”€â”€ projectController.ts   # é¡¹ç›®æ•°æ®
â”‚   â”œâ”€â”€ services/         # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ authService.ts         # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ crawlerService.ts      # çˆ¬è™«æœåŠ¡
â”‚   â”‚   â””â”€â”€ storageService.ts      # å­˜å‚¨æœåŠ¡
â”‚   â”œâ”€â”€ types/            # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ api.ts        # APIç±»å‹
â”‚   â”‚   â””â”€â”€ modian.ts     # æ•°æ®ç±»å‹
â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ crypto.ts     # åŠ å¯†å·¥å…·
â”‚   â”‚   â””â”€â”€ dataTransform.ts      # æ•°æ®è½¬æ¢
â”‚   â”œâ”€â”€ routes/           # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ index.ts      # ä¸»è·¯ç”±
â”‚   â”œâ”€â”€ tests/            # æµ‹è¯•æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ basic.test.ts # åŸºç¡€åŠŸèƒ½æµ‹è¯•
â”‚   â””â”€â”€ index.ts          # åº”ç”¨å…¥å£
â”œâ”€â”€ data/                 # æ•°æ®å­˜å‚¨ç›®å½•
â”‚   â”œâ”€â”€ index.json        # é¡¹ç›®ç´¢å¼•
â”‚   â””â”€â”€ projects/         # é¡¹ç›®æ•°æ®
â”‚       â””â”€â”€ xx/xx/xx/     # åˆ†å±‚ç›®å½•ç»“æ„
â”œâ”€â”€ API.md               # APIæ–‡æ¡£
â”œâ”€â”€ README.md            # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ package.json         # é¡¹ç›®é…ç½®
â””â”€â”€ tsconfig.json        # TypeScripté…ç½®
```

## ğŸ”§ é…ç½®è¯´æ˜

ä¸»è¦é…ç½®é¡¹åœ¨ `src/config/index.ts` ä¸­ï¼š

```typescript
export const config = {
  server: {
    port: 3000,           // æœåŠ¡ç«¯å£
    host: 'localhost',    // æœåŠ¡åœ°å€
  },
  crawler: {
    defaultDelay: 1000,   // é»˜è®¤è¯·æ±‚é—´éš”(ms)
    minDelay: 500,        // æœ€å°è¯·æ±‚é—´éš”(ms)
    maxDelay: 5000,       // æœ€å¤§è¯·æ±‚é—´éš”(ms)
    timeout: 30000,       // è¯·æ±‚è¶…æ—¶æ—¶é—´(ms)
  },
  storage: {
    dataDir: './data',    // æ•°æ®å­˜å‚¨ç›®å½•
    maxFilesPerDir: 1000, // æ¯ç›®å½•æœ€å¤§æ–‡ä»¶æ•°
  }
};
```

## ğŸ“– API ä½¿ç”¨æŒ‡å—

### å¯åŠ¨çˆ¬è™«

```bash
curl -X POST http://localhost:3000/api/crawler/control \
  -H "Content-Type: application/json" \
  -d '{
    "action": "start",
    "config": {
      "start_id": 100000,
      "end_id": 100010,
      "delay": 1000
    }
  }'
```

### æŸ¥è¯¢ç³»ç»ŸçŠ¶æ€

```bash
curl http://localhost:3000/api/system/status
```

### è·å–é¡¹ç›®åˆ—è¡¨

```bash
curl "http://localhost:3000/api/projects?page=1&limit=10&category=ç§‘æŠ€"
```

### æµ‹è¯•å•ä¸ªé¡¹ç›®çˆ¬å–

```bash
curl "http://localhost:3000/api/crawler/test/114514?save=true"
```

è¯¦ç»†APIæ–‡æ¡£è¯·å‚è€ƒ [API.md](./API.md)

## ğŸ—„ï¸ æ•°æ®å­˜å‚¨è®¾è®¡

### ç›®å½•ç»“æ„

é¡¹ç›®æ•°æ®æŒ‰IDåˆ†å±‚å­˜å‚¨ï¼Œé¿å…å•ç›®å½•æ–‡ä»¶è¿‡å¤šï¼š

```
data/
â”œâ”€â”€ index.json           # å…¨å±€é¡¹ç›®ç´¢å¼•
â””â”€â”€ projects/
    â”œâ”€â”€ 11/45/14/        # é¡¹ç›®ID: 114514
    â”‚   â””â”€â”€ 114514.json  # é¡¹ç›®æ•°æ®æ–‡ä»¶
    â””â”€â”€ 12/34/56/        # é¡¹ç›®ID: 123456
        â””â”€â”€ 123456.json  # é¡¹ç›®æ•°æ®æ–‡ä»¶
```

### æ•°æ®æ ¼å¼

æ¯ä¸ªé¡¹ç›®æ–‡ä»¶åŒ…å«å¤šä¸ªç‰ˆæœ¬çš„æ•°æ®ï¼š

```json
[
  {
    "project_id": 114514,
    "version": 1,
    "crawl_time": "2025-06-18T10:00:00.000Z",
    "data": { /* æ¸…æ´—åçš„é¡¹ç›®æ•°æ® */ },
    "raw_data": { /* åŸå§‹APIæ•°æ®(å¯é€‰) */ }
  },
  {
    "project_id": 114514,
    "version": 2,
    "crawl_time": "2025-06-18T12:00:00.000Z",
    "data": { /* æ›´æ–°åçš„é¡¹ç›®æ•°æ® */ }
  }
]
```

## ğŸ§ª æµ‹è¯•

### è¿è¡ŒåŸºç¡€åŠŸèƒ½æµ‹è¯•

```bash
pnpm exec ts-node src/tests/basic.test.ts
```

### æµ‹è¯•çˆ¬è™«åŠŸèƒ½

```bash
pnpm exec ts-node src/test-crawler.ts
```

### æµ‹è¯•APIæ¥å£

```bash
# å¯åŠ¨æœåŠ¡å™¨
pnpm dev

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæµ‹è¯•
node test-api.js
```

## ğŸ”’ å®‰å…¨è¯´æ˜

- ç³»ç»Ÿä½¿ç”¨å®˜æ–¹APIçš„MD5ç­¾åè®¤è¯æœºåˆ¶
- æ”¯æŒè¯·æ±‚é¢‘ç‡æ§åˆ¶ï¼Œé¿å…å¯¹ç›®æ ‡æœåŠ¡å™¨é€ æˆå‹åŠ›
- æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸æ¶‰åŠæ•æ„Ÿä¿¡æ¯ä¼ è¾“

## ğŸ“ å¼€å‘è¯´æ˜

### ä»£ç è§„èŒƒ

- ä½¿ç”¨TypeScriptä¸¥æ ¼æ¨¡å¼
- éµå¾ªESLintä»£ç è§„èŒƒ
- è¯¦ç»†çš„JSDocæ³¨é‡Š
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

### æ‰©å±•å¼€å‘

1. **æ·»åŠ æ–°çš„æ•°æ®æº**: åœ¨ `services/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æœåŠ¡
2. **æ‰©å±•APIæ¥å£**: åœ¨ `controllers/` ç›®å½•ä¸‹æ·»åŠ æ–°çš„æ§åˆ¶å™¨
3. **è‡ªå®šä¹‰æ•°æ®å¤„ç†**: ä¿®æ”¹ `utils/dataTransform.ts` ä¸­çš„è½¬æ¢é€»è¾‘
4. **æ·»åŠ æ–°çš„å­˜å‚¨æ–¹å¼**: æ‰©å±• `services/storageService.ts`

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„å’Œç½‘ç«™ä½¿ç”¨æ¡æ¬¾ã€‚

## ğŸ™‹â€â™‚ï¸ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ä¿®æ”¹çˆ¬å–é—´éš”ï¼Ÿ

A: åœ¨å¯åŠ¨çˆ¬è™«æ—¶é€šè¿‡ `delay` å‚æ•°æŒ‡å®šï¼Œæˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ `defaultDelay`ã€‚

### Q: æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ

A: é»˜è®¤å­˜å‚¨åœ¨ `./data` ç›®å½•ä¸‹ï¼Œå¯é€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹ã€‚

### Q: å¦‚ä½•æ¸…ç†è¿‡æœŸæ•°æ®ï¼Ÿ

A: è°ƒç”¨ `/api/system/cleanup` æ¥å£ï¼Œæˆ–ä½¿ç”¨å­˜å‚¨æœåŠ¡çš„ `cleanupOldData` æ–¹æ³•ã€‚

### Q: ç³»ç»Ÿæ”¯æŒå¹¶å‘çˆ¬å–å—ï¼Ÿ

A: å½“å‰ç‰ˆæœ¬ä¸ºå•çº¿ç¨‹çˆ¬å–ï¼Œé¿å…å¯¹ç›®æ ‡æœåŠ¡å™¨é€ æˆè¿‡å¤§å‹åŠ›ã€‚

---

**æ³¨æ„**: è¯·åˆç†ä½¿ç”¨çˆ¬è™«åŠŸèƒ½ï¼Œéµå®ˆç½‘ç«™robots.txtè§„åˆ™å’Œç›¸å…³æ³•å¾‹æ³•è§„ã€‚
